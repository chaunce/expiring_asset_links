# expiring_asset_links

CarrierWave FOG Expiring Asset Links

Handles storing and generating CarrierWave FOG expiring asset link stored in string and text attributes of ActiveRecord objects

This is helpful when using a WYSIWYG that inserts and previews assets directly from S3 using full S3 URLs.  These URLs need to be updated each time the object is reloaded.  When used in conjunction with CarrierWave and FOG gems, this gem will automatically update these links for you.

## Dependencies

the following gems are required

    gem 'rails', '>= 4.0.0'
    gem 'carrierwave'
    gem 'fog'

## Installation

install manually

    gem install expiring_asset_links

or add it to your Gemfile

    gem 'carrierwave'

## Usage

### configure CarrierWave

your configuration must satisfy the following requirements:

* specify `storage :fog`
* use the default `store_dir` string or one that ends with `folder/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}`

  any of the following will work

<pre>
uploads/#{Rails.env}/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}
uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}
#{Rails.env}/uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}
#{Rails.env}/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}
a/series/of/folder/names/or/1/numbers/2/that_do/not/contain/spaces/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}
</pre>

* `s3_headers` must include a value for `Expires`

for example

    class AssetUploader < CarrierWave::Uploader::Base
      storage :fog
    
      def s3_headers
        { "Expires" => 5.minutes.from_how.httpdate }
      end
    
      def store_dir
        "uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
      end
    
    end

### mount an uploader for any class containing an assets

you may use as many different classes as you would like, but each may only contain one mounted uploader

    class Image
      mount_uploader :image, ImageUploader
    
    end
    
    class Attachment
      mount_uploader :file, FileUploader
    
    end

### specify the attributes that will contain asset links

the attributes specified should contain fully qualified asset URLs generated by CarrierWave with the `Expires` value specified when saved, these URLs will be automatically updated each time the attribute is accessed

    class Document < ActiveRecord::Base
      attr_expiring_asset_links :body
    
    end
    
    class Article < ActiveRecord::Base
      attr_expiring_asset_links :summary, :body
    
    end
